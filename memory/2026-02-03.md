# 2026-02-03 Memory Log

## Heartbeat 调度系统重构

### 关键进展
- 完成 Heartbeat 调度系统全面重构
- 设计模块化架构，支持独立作业管理
- 增强日志记录和错误处理机制
- 添加系统监控和自愈脚本

## OpenClaw文章项目
- sitin(@sitinme)发了篇"OpenClaw真香"文章，6.4万阅读174赞，场景是基础内容自动化
- 我们的场景更硬核：Kalshi交易、BTC套利、美股监控、AI报税、sub-agent管理
- 写了完整初稿v2：`content/openclaw-article-v2.md`，标题"OpenClaw不只是帮你发微博"
- 风格：踩坑故事驱动，不编数据，真实经历为核心
- 发布策略：X Article + 微信公众号 + 知乎
- 需要：Jason审稿 + 补截图 + 定发布时间
- Miles Deutscher也发了OpenClaw插件推荐帖（128赞）

## Sub-agent管控系统（重大改进）
- **问题**：sub-agent反复announce未验证内容到群里，卡住几小时没人管
- **Jason核心反馈**：写一堆md rule都没用，要code hook强制执行
- **已实施的代码级控制：**
  1. `clawdbot.json` 配置：sub-agent禁用 message/cron/gateway/sessions_send（框架级deny）
  2. `scripts/subagent-spawn-wrapper.sh` — spawn前注册tracking
  3. `scripts/subagent-monitor.sh` — 检测卡住（>5min无输出, >15min总时长）
  4. `scripts/subagent-guard.sh` — 验证输出（编造数据扫描+路径泄露检测）
  5. `scripts/subagent-complete.sh` — 标记完成
  6. HEARTBEAT.md加了sub-agent健康监控，每次heartbeat都检查
  7. TOOLS.md顶部加了ANNOUNCE_SKIP强制规则（sub-agent可见）
  8. `scripts/run-background-task.sh` — oracle CLI替代方案，完全绕过announce
- **GitHub Issue #8299** 已提：请求framework级 `announcePolicy: "skip"` config
- **Iron Law #0更新**：完整的3-script mandatory workflow写入AGENTS.md

## X Post文案
- 写了agent-guardrails的推广文案（中英双版），用于quote reply Miles的帖子
- 核心信息："Prompt是建议，Git hooks是法律"

## Memory系统优化
- 清理17个垃圾文件（haiku session写的错误日期2024-*），208KB→144KB
- 启用local embedding（node-llama-cpp），memory_search可用语义搜索
- 创建 `scripts/memory-cleanup.sh` weekly cleanup脚本
- Cron: 每周一06:00 UTC自动归档旧日志
- memory_search之前因缺OpenAI/Google key不可用，现在用local模型

## 社区Skills研究
- **Jason重要反馈**：不该什么都自己造轮子，要善于利用社区现有work
- ClawHub生态还很早期（最热skill才51次下载），Finance类几乎空白
- **已安装 find-skills** — skill发现工具
- **研究了Polymarket Arbitrage skill** — 核心逻辑（risk score + stale data detection）已移植到kalshi/parity_scanner.py
  - calculate_risk_score()：基于volume/edge/legs/type的综合风险评分
  - stale_warning：edge>3%几乎肯定是过时数据
- 下载了Security Audit Toolkit到research/，待对比agent-guardrails
- **教训**：站在社区肩膀上改进，再回馈社区 = 正循环

## 美股市场
- 今天Risk-off日：Nasdaq -2.1%, VIX +16.2%, 科技板块 -3.6%
- NVO暴跌14.6%, CRM/NOW/WDAY等SaaS集体重挫
- 避险资产全线走强：黄金+2.6%突破$4960, 原油+3.6%
- 市场报告系统正常触发告警

## gh CLI
- 安装了GitHub CLI (gh 2.86.0) via homebrew
- Token权限不够（缺read:org scope），用curl API直接提了issue

## 关键决策
- sub-agent管控从"提示词规则"升级到"代码强制"——这是系统性转变
- 优先用oracle exec方案做后台任务，sessions_spawn只在需要工具时用
- 社区skills要主动研究利用，不自己造轮子

## 深夜研究：OpenClaw中文社区（02-04凌晨）
- Jason布置任务：深度研究X上中文AI社区对OpenClaw的使用技巧/心得/痛点
- X搜索受限（需要登录），改用nitter.cz、fxtwitter API、GitHub、SegmentFault
- **核心发现：** SegmentFault上5天内40+篇深度文章，中文社区正在爆发期
- **5大痛点：** 部署复杂、中国平台缺失、成本控制、安全风险、中转API
- **独特优势：** 我们的sub-agent代码级管控（Iron Laws + code hooks）全网独一无二
- 完整报告：research/x-openclaw-community/RESEARCH-REPORT.md
- Model routing已实施：默认Sonnet，简单任务Haiku
- nitter.cz是读X帖子+回复的可用方法（不需要cookie）

## 深夜研究完成总结 (02-04 06:15 UTC)
研究范围远超预期，发现：
- **B站1436个视频** — 这才是中文OpenClaw社区最大阵地（之前以为是SegmentFault）
- **HN 640+ stories** — 最高666 pts的改名story，安全stories也获高关注
- **SegmentFault 40+篇** — 深度技术文章
- **GitHub 1265+ open issues** — #2热门feature是飞书/微信支持(27👍)
- **NanoClaw** — 500行TS复刻版4261⭐，极简化是一个方向
- **Moltbook** — AI社交网络引发HN 881条评论讨论
- **安全** — Argus发现512个安全问题(8 CRITICAL)，RCE漏洞story 177pts
- **我们的差异化**: sub-agent代码级管控(Iron Laws + code hooks)全网独一无二
